generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model users {
  id                Int                 @id @default(autoincrement())
  email             String              @unique
  password_hash     String?
  name              String?
  created_at        DateTime            @default(now())
  avatar            String?
  auth_accounts     auth_accounts[]
  platform_accounts platform_accounts[]
}

model platform_accounts {
  id              Int             @id @default(autoincrement())
  user_id         Int
  platform        String
  access_token    String
  external_app_id String?
  settings        Json?
  created_at      DateTime        @default(now())
  conversations   conversations[]
  user            users           @relation(fields: [user_id], references: [id])

  @@unique([user_id, platform, external_app_id], name: "user_platform_bot_unique")
}

model conversations {
  id                  Int               @id @default(autoincrement())
  platform_account_id Int
  external_chat_id    String
  contact_name        String?
  contact_username    String?
  contact_avatar      String?
  platform            String
  created_at          DateTime          @default(now())
  platform_account    platform_accounts @relation(fields: [platform_account_id], references: [id])
  messages            messages[]

  @@unique([external_chat_id, platform_account_id])
}

model messages {
  id                  Int            @id @default(autoincrement())
  conversation_id     Int?
  sender_type         String
  external_message_id String?
  text                String?
  attachments         Json?
  platform            String
  timestamp           DateTime?
  created_at          DateTime       @default(now())
  conversation        conversations? @relation(fields: [conversation_id], references: [id])
}

model auth_accounts {
  id                  Int       @id @default(autoincrement())
  user_id             Int
  provider            String
  provider_account_id String
  access_token        String?
  refresh_token       String?
  expires_at          BigInt?
  scope               String?
  token_type          String?
  id_token            String?
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  user                users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, provider_account_id], name: "provider_provider_account_unique", map: "provider_provider_account_unique")
  @@map("auth_accounts")
}